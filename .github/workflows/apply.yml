name: Terraform plan

on:
  workflow_dispatch:

concurrency:
  group: ${{ github.ref }}
  cancel-in-progress: true

jobs:
  build_frontend:
    uses: socrateasehq/eqp-core/.github/workflows/build-frontend.yml@FEATURE/actions-deployment

  deployment:
    uses: socrateasehq/eqp-core/.github/workflows/deployment.yml@FEATURE/actions-deployment
    needs:
      - build_frontend
    with:
      environment: prod
      flask_env: production
    secrets:
      aws-access-key-id: ${{ secrets.AWS_ACCESS_KEY_ID }}
      aws-secret-access-key: ${{ secrets.AWS_SECRET_ACCESS_KEY }}